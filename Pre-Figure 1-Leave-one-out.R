####Leave-one-out Quality Control ####
library(MetaIntegrator)
{datasetObject$originalData$GSE112447$expr<-as.matrix(GSE112447_data)
  datasetObject$originalData$GSE112447$class<-mycn_state_newe_GSE112447
  datasetObject$originalData$GSE112447$formattedName<-'GSE112447_GPL6480_57'
  datasetObject$originalData$GSE112447$pheno<-phe_new_GSE112447
  datasetObject$originalData$GSE112447$keys<-b}#GSE112447

{datasetObject$originalData$GSE120572$expr<-as.matrix(GSE120572_data)
  datasetObject$originalData$GSE120572$class<-mycn_state_newe_GSE120572
  datasetObject$originalData$GSE120572$formattedName<-'GSE120572_GPL16876_394'
  datasetObject$originalData$GSE120572$pheno<-phe_new_GSE120572
  datasetObject$originalData$GSE120572$keys<-b}## GSE120572

{datasetObject$originalData$GSE73517$expr<-as.matrix(GSE73517_data)
  datasetObject$originalData$GSE73517$class<-mycn_state_newe_GSE73517
  datasetObject$originalData$GSE73517$formattedName<-'GSE73517_GPL16876_105'
  datasetObject$originalData$GSE73517$pheno<-phe_new_GSE73517
  datasetObject$originalData$GSE73517$keys<-b}## GSE73517

{datasetObject$originalData$GSE73537$expr<-as.matrix(GSE73537_data)
  datasetObject$originalData$GSE73537$class<-mycn_state_newe_GSE73537
  datasetObject$originalData$GSE73537$formattedName<-'GSE73537_GPL1570_34'
  datasetObject$originalData$GSE73537$pheno<-phe_new_GSE73537
  datasetObject$originalData$GSE73537$keys<-b}## GSE73537

{datasetObject$originalData$GSE49710$expr<-as.matrix(GSE49710_data)
  datasetObject$originalData$GSE49710$class<-mycn_state_newe_GSE49710
  datasetObject$originalData$GSE49710$formattedName<-'GSE49710_GPL16876_498'
  datasetObject$originalData$GSE49710$pheno<-phe_new_GSE49710
  datasetObject$originalData$GSE49710$keys<-b}## GSE49710

{datasetObject$originalData$GSE53371$expr<-as.matrix(GSE53371_data)
  datasetObject$originalData$GSE53371$class<-mycn_state_newe_GSE53371
  datasetObject$originalData$GSE53371$formattedName<-'GSE53371_GPL887_20'
  datasetObject$originalData$GSE53371$pheno<-phe_new_GSE53371
  datasetObject$originalData$GSE53371$keys<-b}## GSE53371

{datasetObject$originalData$GSE45547$expr<-as.matrix(GSE45547_data)
  datasetObject$originalData$GSE45547$class<-mycn_state_newe_GSE45547
  datasetObject$originalData$GSE45547$formattedName<-'GSE45547_GPL6876_649'
  datasetObject$originalData$GSE45547$pheno<-phe_new_GSE45547
  datasetObject$originalData$GSE45547$keys<-b}## GSE45547

{datasetObject$originalData$GSE19274$expr<-as.matrix(GSE19274_data)
  datasetObject$originalData$GSE19274$class<-mycn_state_newe_GSE19274
  datasetObject$originalData$GSE19274$formattedName<-'GSE19274_GPL6102_100'
  datasetObject$originalData$GSE19274$pheno<-phe_new_GSE19274
  datasetObject$originalData$GSE19274$keys<-b}## GSE19274

{datasetObject$originalData$GSE16237$expr<-as.matrix(GSE16237_data)
  datasetObject$originalData$GSE16237$class<-mycn_state_newe_GSE16237
  datasetObject$originalData$GSE16237$formattedName<-'GSE16237_GPL570_51'
  datasetObject$originalData$GSE16237$pheno<-phe_new_GSE16237
  datasetObject$originalData$GSE16237$keys<-b}## GSE16237

{datasetObject$originalData$GSE14880$expr<-as.matrix(GSE14880_data)
  datasetObject$originalData$GSE14880$class<-mycn_state_newe_GSE14880
  datasetObject$originalData$GSE14880$formattedName<-'GSE14880_GPL570_29'
  datasetObject$originalData$GSE14880$pheno<-phe_new_GSE14880
  datasetObject$originalData$GSE14880$keys<-b}## GSE14880

{datasetObject$originalData$GSE13136$expr<-as.matrix(GSE13136_data)
  datasetObject$originalData$GSE13136$class<-mycn_state_newe_GSE13136
  datasetObject$originalData$GSE13136$formattedName<-'GSE13136_GPL570_30'
  datasetObject$originalData$GSE13136$pheno<-phe_new_GSE13136
  datasetObject$originalData$GSE13136$keys<-b}## GSE13136

{datasetObject$originalData$GSE27608$expr<-as.matrix(GSE16476_data)
  datasetObject$originalData$GSE27608$class<-mycn_state_newe
  datasetObject$originalData$GSE27608$formattedName<-'GSE27608_GPL5188_47'
  datasetObject$originalData$GSE27608$pheno<-phe_new
  datasetObject$originalData$GSE27608$keys<-b}## GSE27608

{datasetObject$originalData$GSE21713$expr<-as.matrix(GSE21713_data)
  datasetObject$originalData$GSE21713$class<-mycn_state_newe_GSE21713
  datasetObject$originalData$GSE21713$formattedName<-'GSE21713_GPL5175_40'
  datasetObject$originalData$GSE21713$pheno<-phe_new_GSE21713
  datasetObject$originalData$GSE21713$keys<-b}## GSE21713

{datasetObject$originalData$GSE85047$expr<-as.matrix(GSE85047_data)
  datasetObject$originalData$GSE85047$class<-mycn_state_newe_GSE85047
  datasetObject$originalData$GSE85047$formattedName<-'GSE85047_GPL5175_283'
  datasetObject$originalData$GSE85047$pheno<-phe_new_GSE85047
  datasetObject$originalData$GSE85047$keys<-b}## GSE85047

{datasetObject$originalData$GSE16476$expr<-as.matrix(GSE16476_data)
  datasetObject$originalData$GSE16476$class<-mycn_state_newe
  datasetObject$originalData$GSE16476$formattedName<-'GSE16476_GPL570_88'
  datasetObject$originalData$GSE16476$pheno<-phe_new
  datasetObject$originalData$GSE16476$keys<-b}## GSE16476

{datasetObject$originalData$GSE79910$expr<-as.matrix(GSE79910_data)
  datasetObject$originalData$GSE79910$class<-mycn_state_newe_GSE79910
  datasetObject$originalData$GSE79910$formattedName<-'GSE79910_GPL16876_27'
  datasetObject$originalData$GSE79910$pheno<-phe_new_GSE79910
  datasetObject$originalData$GSE79910$keys<-b}## GSE79910

{datasetObject$originalData$E_MTAB_1781$expr<-as.matrix(E_MTAB_1781_data_new)
  datasetObject$originalData$E_MTAB_1781$class<-mycn_state_newe_E-MTAB_1781
  datasetObject$originalData$E_MTAB_1781$formattedName<-'E-MTAB_1781_GPL16876_683'
  datasetObject$originalData$E_MTAB_1781$pheno<-phe_new_E_MTAB_1781
  datasetObject$originalData$E_MTAB_1781$keys<-b}## E-MTAB_1781

{datasetObject$originalData$E_MTAB_8248$expr<-as.matrix(E_MTAB_8248_data_new)
  datasetObject$originalData$E_MTAB_8248$class<-mycn_state_newe_E_MTAB_8248
  datasetObject$originalData$E_MTAB_8248$formattedName<-'E-MTAB_8248_GPL16876_222'
  datasetObject$originalData$E_MTAB_8248$pheno<-phe_new_E_MTAB_8248
  datasetObject$originalData$E_MTAB_8248$keys<-b}## E-MTAB_8248

{datasetObject$originalData$E_MTAB_179$expr<-as.matrix(E_MTAB_179_data_new)
  datasetObject$originalData$E_MTAB_179$class<-mycn_state_newe_E_MTAB_179
  datasetObject$originalData$E_MTAB_179$formattedName<-'E-MTAB_179_GPL16876_477'
  datasetObject$originalData$E_MTAB_179$pheno<-phe_new_E_MTAB_179
  datasetObject$originalData$E_MTAB_179$keys<-b}## E-MTAB_179

{datasetObject$originalData$E_MEXP_3517$expr<-as.matrix(E_MEXP_3517_data_new)
  datasetObject$originalData$E_MEXP_3517$class<-mycn_state_newe_E_MEXP_3517
  datasetObject$originalData$E_MEXP_3517$formattedName<-'E-MEXP_3517_GPL5175_42'
  datasetObject$originalData$E_MEXP_3517$pheno<-phe_new_E_MEXP_3517
  datasetObject$originalData$E_MEXP_3517$keys<-b}## E-MEXP_3517

checkDataObject(datasetObject$originalData$GSE112447,'Dataset')
checkDataObject(datasetObject$originalData$GSE120572,'Dataset')
checkDataObject(datasetObject$originalData$GSE73517,'Dataset')
checkDataObject(datasetObject$originalData$GSE73537,'Dataset')
checkDataObject(datasetObject$originalData$GSE49710,'Dataset')
checkDataObject(datasetObject$originalData$GSE53371,'Dataset')
checkDataObject(datasetObject$originalData$GSE45547,'Dataset')
checkDataObject(datasetObject$originalData$GSE19274,'Dataset')
checkDataObject(datasetObject$originalData$GSE16237,'Dataset')
checkDataObject(datasetObject$originalData$GSE14880,'Dataset')
checkDataObject(datasetObject$originalData$GSE13136,'Dataset')

checkDataObject(datasetObject$originalData$GSE27608,'Dataset')
checkDataObject(datasetObject$originalData$GSE21713,'Dataset')
checkDataObject(datasetObject$originalData$GSE85047,'Dataset')
checkDataObject(datasetObject$originalData$GSE16476,'Dataset')
checkDataObject(datasetObject$originalData$GSE79910,'Dataset')
checkDataObject(datasetObject$originalData$E_MTAB_1781,'Dataset')
checkDataObject(datasetObject$originalData$E_MTAB_8248,'Dataset')
checkDataObject(datasetObject$originalData$E_MTAB_179,'Dataset')
checkDataObject(datasetObject$originalData$E_MEXP_3517,'Dataset')

# use the additional 2 example datasets from tinyMetaObject
dataObj1 = datasetObject$originalData$GSE120572 # 394 samples
dataObj2 = datasetObject$originalData$GSE112447 # 57 samples
dataObj3 = datasetObject$originalData$GSE73517 # 105 samples 
dataObj4 = datasetObject$originalData$GSE73537 #34 samples delete as AUC <0.5 
dataObj5 = datasetObject$originalData$GSE49710 # 498 samples
dataObj6 = datasetObject$originalData$GSE53371 #20 samples delete as AUC <0.5 
dataObj7 = datasetObject$originalData$GSE45547 # 649 samples
dataObj8 = datasetObject$originalData$GSE19274 #100 samples
dataObj9 = datasetObject$originalData$GSE16237 # 51 samples
dataObj10 = datasetObject$originalData$GSE14880 # 29 samples
dataObj11 = datasetObject$originalData$GSE13136 #30 samples

dataObj12 = datasetObject$originalData$GSE27608 # 47 samples
dataObj13 = datasetObject$originalData$GSE21713 # 40 samples
dataObj14 = datasetObject$originalData$GSE85047 #283 samples
dataObj15 = datasetObject$originalData$GSE16476 #88 samples
dataObj16 = datasetObject$originalData$GSE79910 #27 samples
dataObj17 = datasetObject$originalData$E_MTAB_1781 #683 samples
dataObj18 = datasetObject$originalData$E_MTAB_8248 #222 samples
dataObj19 = datasetObject$originalData$E_MTAB_179 #477 samples
dataObj20 = datasetObject$originalData$E_MEXP_3517 #42 samples

#### EXAMPLE: Using dataset 1-19 to generate MYCN-siganture and test the quality of dataset20.
discovery_datasets <- list(dataObj1,dataObj2,dataObj3,
                           dataObj4,dataObj5,dataObj6,
                           dataObj7,dataObj8,dataObj9,
                           dataObj10,dataObj11,,dataObj12,
                           dataObj13,dataObj14,dataObj15,
                           dataObj16,dataObj17,dataObj18,
                           dataObj19)

names(discovery_datasets) = c(dataObj1$formattedName, dataObj2$formattedName,
                              dataObj3$formattedName, dataObj4$formattedName,
                              dataObj5$formattedName, dataObj6$formattedName,
                              dataObj7$formattedName,dataObj8$formattedName,
                              dataObj9$formattedName, dataObj10$formattedName,
                              dataObj11$formattedName,dataObj12$formattedName,
                              dataObj13$formattedName,dataObj14$formattedName,
                              dataObj15$formattedName,dataObj16$formattedName,
                              dataObj17$formattedName,dataObj18$formattedName,
                              dataObj19$formattedName)
validation_datasets <- list(dataObj20)
names(validation_datasets)<-c(dataObj20$formattedName)

exampleMetaObj=list() 
exampleMetaObj$originalData <- discovery_datasets
exampleMetaObj_validation<-list()
exampleMetaObj_validation$originalData <- validation_datasets
checkDataObject(exampleMetaObj, "Meta", "Pre-Analysis") ###Check your metaObject before MetaAnalysis
checkDataObject(exampleMetaObj_validation, "Meta", "Pre-Analysis")

exampleMetaObj <- runMetaAnalysis(exampleMetaObj, maxCores=4,runLeaveOneOutAnalysis = FALSE)
#save(exampleMetaObj, file="RData/testingObjectMeta.RData")
exampleMetaObj_validation <- runMetaAnalysis(exampleMetaObj_validation, 
                                             maxCores=4,runLeaveOneOutAnalysis = FALSE)
#save(exampleMetaObj_validation, file="RData/testingObjectMeta.RData")

exampleMetaObj <- filterGenes(exampleMetaObj, isLeaveOneOut = F, FDRThresh = 0.05,effectSizeThresh = 1.3)
exampleMetaObj_validation <- filterGenes(exampleMetaObj_validation, isLeaveOneOut = F, FDRThresh = 0.05,effectSizeThresh = 1.3)

MYCNscores <- calculateScore(filterObject = exampleMetaObj$filterResults[[1]], 
                             datasetObject = exampleMetaObj$originalData[[1]])
forwardRes <- forwardSearch( metaObject = exampleMetaObj, 
                             filterObject =exampleMetaObj$filterResults[[1]])
forwardRes <- forwardSearch( metaObject = exampleMetaObj_validation, 
                             filterObject =exampleMetaObj_validation$filterResults[[1]])

pdf('E.MEXP_3517_GPL5175_42.pdf',width = 10,height = 10)
rocPlot(datasetObject = exampleMetaObj_validation$originalData$E.MEXP_3517_GPL5175_42,
        filterObject = exampleMetaObj$filterResults[[1]])
dev.off()
